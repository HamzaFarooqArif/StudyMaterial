!function(e,t){for(var i in t)e[i]=t[i]}(window,webpackJsonp([16,33],{"./common/lib/xmodule/xmodule/assets/vertical/public/js/vertical_student_view.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){var t=i("./openedx/features/course_bookmarks/static/course_bookmarks/js/views/bookmark_button.js"),s=i.n(t),n=i("./lms/static/completion/js/CompletionOnViewService.js");new Set;window.VerticalStudentView=function(t,o){var a=e(o),r=a.find(".bookmark-button");return i.i(n.markBlocksCompletedOnViewIfNeeded)(t,o),new s.a({el:r,bookmarkId:r.data("bookmarkId"),usageId:a.data("usageId"),bookmarked:a.parent("#seq_content").data("bookmarked"),apiUrl:r.data("bookmarksApiUrl")})}}.call(t,i(0))},"./lms/static/completion/js/CompletionOnViewService.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){function s(t,i){var s=e(i).find(".xblock-student_view[data-mark-completed-on-view-after-delay]").get();if(s.length>0){var a=new n.a;s.forEach(function(e){var t=parseInt(e.dataset.markCompletedOnViewAfterDelay,10);t>=0&&a.addElement(e,t)}),a.addHandler(function(i,s){var n=i.dataset.usageId;n&&!o.has(n)&&s.elementHasBeenViewed&&e.ajax({type:"POST",url:t.handlerUrl(i,"publish_completion"),data:JSON.stringify({completion:1})}).then(function(){o.add(n),i.dataset.markCompletedOnViewAfterDelay=0})})}}t.markBlocksCompletedOnViewIfNeeded=s;var n=i("./lms/static/completion/js/ViewedEvent.js"),o=new Set}.call(t,i(0))},"./lms/static/completion/js/ViewedEvent.js":function(e,t,i){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){function i(){var i=Date.now();s+t<i&&(s=i,e())}var s=0;return i}i.d(t,"a",function(){return r});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),a=function(){function e(t,i,n){s(this,e),this.el=t,this.viewedAfterMs=i,this.callback=n,this.topSeen=!1,this.bottomSeen=!1,this.seenForMs=0,this.becameVisibleAt=void 0,this.hasBeenViewed=!1}return o(e,[{key:"getBoundingRect",value:function(){return this.el.getBoundingClientRect()}},{key:"handleVisible",value:function(){var e=this;this.becameVisibleAt||(this.becameVisibleAt=Date.now(),setTimeout(function(){e.checkIfViewed()},this.viewedAfterMs-this.seenForMs))}},{key:"handleNotVisible",value:function(){this.becameVisibleAt&&(this.seenForMs=Date.now()-this.becameVisibleAt),this.becameVisibleAt=void 0}},{key:"markTopSeen",value:function(){this.topSeen=!0,this.checkIfViewed()}},{key:"markBottomSeen",value:function(){this.bottomSeen=!0,this.checkIfViewed()}},{key:"getTotalTimeSeen",value:function(){return this.becameVisibleAt?this.seenForMs+(Date.now()-this.becameVisibleAt):this.seenForMs}},{key:"areViewedCriteriaMet",value:function(){return this.topSeen&&this.bottomSeen&&this.getTotalTimeSeen()>=this.viewedAfterMs}},{key:"checkIfViewed",value:function(){this.hasBeenViewed||this.areViewedCriteriaMet()&&(this.hasBeenViewed=!0,this.callback(this.el,{elementHasBeenViewed:this.hasBeenViewed}))}}]),e}(),r=function(){function e(){s(this,e),this.elementViewings=new Set,this.handlers=[],this.registerDomHandlers()}return o(e,[{key:"addElement",value:function(e,t){var i=this;this.elementViewings.add(new a(e,t,function(e,t){return i.callHandlers(e,t)})),this.updateVisible()}},{key:"addHandler",value:function(e){this.handlers.push(e)}},{key:"updateVisible",value:function(){this.elementViewings.forEach(function(e){if(!e.hasBeenViewed){var t=Date.now(),i=e.getBoundingRect(),s=!1;i.top>0&&i.top<window.innerHeight&&(e.markTopSeen(t),s=!0),i.bottom>0&&i.bottom<window.innerHeight&&(e.markBottomSeen(t),s=!0),i.top<0&&i.bottom>window.innerHeight&&(s=!0),s?e.handleVisible(t):e.handleNotVisible(t)}})}},{key:"registerDomHandlers",value:function(){var e=this;window.onscroll=n(function(){return e.updateVisible()},100),window.onresize=n(function(){return e.updateVisible()},100),this.updateVisible()}},{key:"callHandlers",value:function(e,t){this.handlers.forEach(function(i){i(e,t)})}}]),e}()},"./lms/static/js/views/message_banner.js":function(e,t,i){"use strict";var s,n;s=[i(3),i(0),i(1),i(2),i("./lms/templates/fields/message_banner.underscore")],void 0!==(n=function(e,t,i,s,n){return s.View.extend({initialize:function(e){i.isUndefined(e)&&(e={}),this.options=i.defaults(e,{urgency:"high",type:""})},render:function(){return i.isUndefined(this.message)||i.isNull(this.message)?this.$el.html(""):this.$el.html(i.template(n)(i.extend(this.options,{message:this.message}))),this},showMessage:function(e){this.message=e,this.render()},hideMessage:function(){this.message=null,this.render()}})}.apply(t,s))&&(e.exports=n)},"./lms/templates/fields/message_banner.underscore":function(e,t){e.exports='<div class="wrapper-msg urgency-<%= urgency %> <%= type %>">\n    <div class="msg">\n        <div class="msg-content">\n            <div class="copy">\n                <p><%-message%></p>\n            </div>\n        </div>\n    </div>\n</div>\n'},"./openedx/features/course_bookmarks/static/course_bookmarks/js/views/bookmark_button.js":function(e,t,i){"use strict";var s,n;s=[i(3),i(0),i(1),i(2),i("./lms/static/js/views/message_banner.js")],void 0!==(n=function(e,t,i,s,n){return s.View.extend({errorMessage:e("An error has occurred. Please try again."),bookmarkText:e("Bookmark this page"),bookmarkedText:e("Bookmarked"),events:{click:"toggleBookmark"},showBannerInterval:5e3,initialize:function(e){this.apiUrl=e.apiUrl,this.bookmarkId=e.bookmarkId,this.bookmarked=e.bookmarked,this.usageId=e.usageId,this.setBookmarkState(this.bookmarked)},toggleBookmark:function(e){e.preventDefault(),this.$el.prop("disabled",!0),this.$el.hasClass("bookmarked")?this.removeBookmark():this.addBookmark()},addBookmark:function(){var e=this;t.ajax({data:{usage_id:e.usageId},type:"POST",url:e.apiUrl,dataType:"json",success:function(){e.$el.trigger("bookmark:add"),e.setBookmarkState(!0)},error:function(t){var i,s;try{i=t.responseText?JSON.parse(t.responseText):"",s=i?i.user_message:"",e.showError(s)}catch(t){e.showError()}},complete:function(){e.$el.prop("disabled",!1),e.$el.focus()}})},removeBookmark:function(){var e=this,i=e.apiUrl+e.bookmarkId+"/";t.ajax({type:"DELETE",url:i,success:function(){e.$el.trigger("bookmark:remove"),e.setBookmarkState(!1)},error:function(){e.showError()},complete:function(){e.$el.prop("disabled",!1),e.$el.focus()}})},setBookmarkState:function(e){e?(this.$el.addClass("bookmarked"),this.$el.attr("aria-pressed","true"),this.$el.find(".bookmark-text").text(this.bookmarkedText)):(this.$el.removeClass("bookmarked"),this.$el.attr("aria-pressed","false"),this.$el.find(".bookmark-text").text(this.bookmarkText))},showError:function(e){var s=e||this.errorMessage;this.messageView||(this.messageView=new n({el:t(".message-banner"),type:"error"})),this.messageView.showMessage(s),setTimeout(i.bind(function(){this.messageView.hideMessage()},this),this.showBannerInterval)}})}.apply(t,s))&&(e.exports=n)}},["./common/lib/xmodule/xmodule/assets/vertical/public/js/vertical_student_view.js"]));