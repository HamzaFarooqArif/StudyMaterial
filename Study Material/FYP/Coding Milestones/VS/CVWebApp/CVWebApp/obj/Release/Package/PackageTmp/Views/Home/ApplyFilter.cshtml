@model CVWebApp.Models.PhotoClassViewModels
@{
    ViewBag.Title = "ApplyFilter";
}

<h2>ApplyFilter</h2>

@*<img src=@Model.imageData alt="Filtered Image" />*@
<div class="alert alert-danger d-none" id="errMsg" role="alert"></div>
@using (Html.BeginForm("ApplyFilter", "Home", FormMethod.Post,
                                        new { enctype = "multipart/form-data" }))
{
    <div class="row">
        <div class="col-md-8" style="height:300px">
            <img id="stdImg" class="rounded float-left" width="270" height="300" src="~/SampleImages/dummyImg.jpg" />
            <img id="stdImgFilter" class="rounded float-left" width="270" height="300" src="~/SampleImages/dummyImg.jpg" />
        </div>
        <div class="col-md-4">
            <br />
            <br />
            <h4>Instructions</h4>
            <ul>
                <li>
                    Upload passport size photograph
                </li>
                <li>
                    Maximum allowed file size is 1MB.
                </li>
                <li>
                    This photograph will be used as photo identity in test center
                </li>
            </ul>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="form-group">
                <label>Upload Image</label>
                <input type="file" id="file" class="form-control-file" name="file" onchange="readURL(this)" accept="image/gif, image/jpeg, image/png" />
            </div>
        </div>
    </div>
    @*<div class="row d-flex justify-content-right">
        <input type="submit" class="btn btn-primary" value="Upload" />
    </div>*@
    <button onclick="sendImg()">Apply</button>
}
<script>
    function readURL(input) {
        if (input.files && input.files[0]) {
            var size = input.files[0].size;
            if (size > 1024000) {
                $("#file").val("");
                $("#errMsg").html("Maximum file size exceeds. Maximum allowed file size is 1MB.");
                $("#errMsg").removeClass("d-none");
                return;
            }
            else {
                var reader = new FileReader();
                $("#errMsg").addClass("d-none");
                reader.onload = function (e) {
                    $('#stdImg')
                        .attr('src', e.target.result);
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
    }
</script>
<script type="text/javascript">
        function sendImg()
        {
            var obj = {
                "imgString": $("#stdImg")[0].src
            }                        if (obj.length < 100)            {
                $("#file").val("");
                $("#errMsg").html("Please Select a valid file");
                $("#errMsg").removeClass("d-none");
                return;
            }
            debugger;
            event.preventDefault();
            var $url = '@Url.Action("sendImage", "Home")';
            $.ajax({
                data: JSON.stringify(obj),
                contentType: "application/json",
                url: $url,
                type: 'POST',
                datatype: "json",
                //data: "imgString=" + $("#stdImg").attr('src'),
                success: function (r) {
                    $("#stdImgFilter").attr('src', r);
                }
            });
        }
</script>